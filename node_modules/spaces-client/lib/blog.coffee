# Test commands:
#
# curl -X POST -H "Cookie:_social_navigator_session=rGbu73bk-gXSbv23lDWWlqxLnC0" -H "CONTENT-TYPE:application/x-www-form-urlencoded" -H "ACCEPT:application/vnd.moxiesoft.spaces-v1+json" -d 'blog%5Btitle%5D=qui+doloremque+minima+rerum+consequatur+magni+et+delectus&blog%5Bbody%5D=et+similique+fugiat+accusantium+quis+consequatur+aliquam+vitae+illo%0Aodit+ut+qui+nihil+modi+sunt+quod+aliquid%0Arerum+ea+dolores' https://xxgonzalo.moxiedev.com/blogs

class Blog
  Faker = require('faker')
  Resource = require('./resource')

  @showBlog = (site, sessionId, resourceId, parentId, userId, onsuccess, onfail) ->
    addlHeaders = {
      "Cookie": ["_social_navigator_session=" + sessionId, "path=/"],
      "Accept": "application/vnd.moxiesoft.spaces-v1+json"
    }
    Resource.getResource(site, userId, sessionId, 'blogs/' + resourceId, addlHeaders, ((res) ->
      onsuccess()
    ), (() ->
      onfail()
    ))

  @createBlog = (site, sessionId, resourceId, parentId, userId, onsuccess, onfail, oncreate) ->
    data = {
      blog: {
        title: Faker.Lorem.sentences(1),
        body: Faker.Lorem.sentences(4)
      }
    }
    data['blog']['parent_id'] = parentId if parentId
    Resource.createResource(site, userId, sessionId, 'blogs', data, onsuccess, onfail, oncreate)

  @updateBlog = (site, sessionId, resourceId, parentId, userId, onsuccess, onfail) ->
    data = {
      blog: {
        title: Faker.Lorem.sentences(1)
      }
    }
    Resource.editResource(site, userId, sessionId, 'blogs/' + resourceId, data, onsuccess, onfail)

  @deleteBlog = (site, sessionId, resourceId, userId, onsuccess, onfail, ondestroy) ->
    Resource.deleteResource(site, userId, sessionId, 'blogs/' + resourceId, onsuccess, onfail, ondestroy)

  @showBlogpost = (site, sessionId, resourceId, parentId, userId, onsuccess, onfail) ->
    addlHeaders = {
      "Accept": "application/vnd.moxiesoft.spaces-v1+json",
      "Cookie": ["_social_navigator_session=" + sessionId, "path=/"]
    }
    Resource.getResource(site, userId, sessionId, 'blog_posts/' + resourceId, addlHeaders, ((res) ->
      onsuccess()
    ), (() ->
      onfail()
    ))

  @createBlogpost = (site, sessionId, resourceId, parentId, userId, onsuccess, onfail, oncreate) ->
    data = {
      blog_post: {
        title: Faker.Lorem.sentences(1),
        body: Faker.Lorem.sentences(20),
        parent_id: parentId
      }
    }
    Resource.createResource(site, userId, sessionId, 'blog_posts', data, onsuccess, onfail, oncreate)

  @updateBlogpost = (site, sessionId, resourceId, parentId, userId, onsuccess, onfail) ->
    data = {
      blog_post: {
        body: Faker.Lorem.sentences(20)
      }
    }
    Resource.editResource(site, userId, sessionId, 'blog_posts/' + resourceId, data, onsuccess, onfail)

  @deleteBlogpost = (site, sessionId, resourceId, parentId, userId, onsuccess, onfail, ondestroy) ->
    Resource.deleteResource(site, userId, sessionId, 'blog_posts/' + resourceId, onsuccess, onfail, ondestroy)

module.exports = exports = Blog