// Generated by CoffeeScript 1.6.3
(function() {
  var Faker, Group, exports;

  Faker = require('Faker');

  Group = (function() {
    function Group() {}

    Group.create = function(site, parentId, userId) {
      var Spaces, XMLHttpRequest, data, xhr;
      Spaces = require('./spaces-client.js');
      data = {
        group: {
          _type: "BasicGroup",
          title: Faker.Lorem.sentences(1),
          body: Faker.Lorem.sentences(4),
          parent_id: parentId
        }
      };
      XMLHttpRequest = require("xmlhttprequest").XMLHttpRequest;
      xhr = new XMLHttpRequest();
      xhr.setDisableHeaderCheck(true);
      xhr.open('POST', site.full_url + "/groups", true);
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.setRequestHeader("Accept", "application/vnd.moxiesoft.spaces-v1+json");
      xhr.setRequestHeader("Cookie", ["_social_navigator_session=" + Spaces.Session.getSessionId(site, userId), "path=/"]);
      xhr.onload = function() {
        var groupId;
        if (this.status === 200 || this.status === 201) {
          groupId = this.responseText.match(/"id":"(.*?)"/)[1];
          Spaces.logger.debug("[%s][%s] Created group [%s]", site.site_id, userId, groupId);
          return Spaces.Session.addItem(site, userId, 'group', groupId);
        } else {
          return Spaces.logger.error("[%s][%s] Group.create failed: %s - %s - %j", site.site_id, userId, this.status, this.responseText, data);
        }
      };
      return xhr.send(JSON.stringify(data));
    };

    return Group;

  })();

  module.exports = exports = Group;

}).call(this);
