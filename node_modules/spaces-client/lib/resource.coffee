class Resource

  @deleteResource = (site, userId, className) ->
    Spaces = require('./spaces-client.js')
    id = Spaces.Session.getRandomUserItemIdOfType(site, userId, className)
    unless id
      Spaces.logger.info "[%s][%s] No appropriate %s can be found", site.site_id, userId, className
      return

    post_options = {
      hostname: site.full_url.match(/https:\/\/(.*)$/)[1],
      path: "/" + className + "s/" + id,
      method: 'DELETE',
      headers: {
        "Accept": 'application/vnd.moxiesoft.spaces-v1+json'
        "Cookie": ["_social_navigator_session=" + Spaces.Session.getSessionId(site, userId), "path=/"]
      }
    }
    post_req = require('https').request(post_options, ((res) ->
      res.setEncoding('utf8')
#      response = ""
#      res.on('data', ((chunk) ->
#        Spaces.logger.debug("[%s][%s] WOOOO: %s", site.site_id, userId, chunk)
#        response = response + chunk
#      ))
      res.on('end', (() ->
        if res.statusCode == 200 || res.statusCode == 201
          Spaces.logger.debug("[%s][%s] Deleted %s [%s]", site.site_id, userId, className, id)
        else
          Spaces.logger.debug("[%s][%s] %s#delete/%s failed: %d - %s", site.site_id, userId, className, id,
            res.statusCode, res.status)
      ))
    ))
    post_req.on('error', ((e) ->
      Spaces.logger.error("[%s][%s] %s#delete/%s failed: %s", site.site_id, userId, className, id, post_req.statusCode)
    ))
    post_req.end()

module.exports = exports = Resource
