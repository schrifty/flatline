// Generated by CoffeeScript 1.6.3
(function() {
  var $, Resource, exports;

  $ = require('jquery');

  Resource = (function() {
    function Resource() {}

    Resource.createResource = function(site, userId, className, dataJson) {
      var Spaces, data, opts, req;
      Spaces = require('./spaces-client.js');
      data = $.param(dataJson);
      opts = {
        hostname: site.full_url.match(/https:\/\/(.*)$/)[1],
        path: "/" + className + "s",
        method: 'POST',
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
          "Accept": 'application/vnd.moxiesoft.spaces-v1+json',
          "Cookie": ["_social_navigator_session=" + Spaces.Session.getSessionId(site, userId), "path=/"]
        }
      };
      req = require('https').request(opts, (function(res) {
        res.setEncoding('utf8');
        return res.on('end', (function() {
          var forumId;
          if (res.statusCode === 200 || res.statusCode === 201) {
            forumId = this.responseText.match(/"id":"(.*?)"/)[1];
            Spaces.logger.debug("[%s][%s] Created %s [%s]", site.site_id, userId, className, forumId);
            return Spaces.Session.addItem(site, userId, className, forumId);
          } else {
            return Spaces.logger.debug("[%s][%s] %s#create/%s failed: %d - %s", site.site_id, userId, className, res.statusCode, res.status);
          }
        }));
      }));
      req.on('error', (function(e) {
        return Spaces.logger.error("[%s][%s] %s#delete/%s failed: %s", site.site_id, userId, className, id, req.statusCode);
      }));
      req.write(data);
      return req.end();
    };

    Resource.deleteResource = function(site, userId, className) {
      var Spaces, id, opts, req;
      Spaces = require('./spaces-client.js');
      id = Spaces.Session.getRandomUserItemIdOfType(site, userId, className);
      if (!id) {
        Spaces.logger.info("[%s][%s] No appropriate %s can be found", site.site_id, userId, className);
        return;
      }
      opts = {
        hostname: site.full_url.match(/https:\/\/(.*)$/)[1],
        path: "/" + className + "s/" + id,
        method: 'DELETE',
        headers: {
          "Accept": 'application/vnd.moxiesoft.spaces-v1+json',
          "Cookie": ["_social_navigator_session=" + Spaces.Session.getSessionId(site, userId), "path=/"]
        }
      };
      req = require('https').request(opts, (function(res) {
        res.setEncoding('utf8');
        return res.on('end', (function() {
          if (res.statusCode === 200 || res.statusCode === 201) {
            return Spaces.logger.debug("[%s][%s] Deleted %s [%s]", site.site_id, userId, className, id);
          } else {
            return Spaces.logger.debug("[%s][%s] %s#delete/%s failed: %d - %s", site.site_id, userId, className, id, res.statusCode, res.status);
          }
        }));
      }));
      req.on('error', (function(e) {
        return Spaces.logger.error("[%s][%s] %s#delete/%s failed: %s", site.site_id, userId, className, id, req.statusCode);
      }));
      return req.end();
    };

    Resource.editResource = function(site, userId, className, dataJson) {
      var Spaces, data, id, opts, req;
      Spaces = require('./spaces-client.js');
      id = Spaces.Session.getRandomUserItemIdOfType(site, userId, className);
      if (!id) {
        Spaces.logger.info("[%s][%s] No appropriate %s can be found", site.site_id, userId, className);
        return;
      }
      data = $.param(dataJson);
      opts = {
        hostname: site.full_url.match(/https:\/\/(.*)$/)[1],
        path: "/" + className + "s/" + id,
        method: 'PUT',
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
          "Accept": 'application/vnd.moxiesoft.spaces-v1+json',
          "Cookie": ["_social_navigator_session=" + Spaces.Session.getSessionId(site, userId), "path=/"]
        }
      };
      req = require('https').request(opts, (function(res) {
        res.setEncoding('utf8');
        return res.on('end', (function() {
          if (res.statusCode === 200 || res.statusCode === 201) {
            return Spaces.logger.debug("[%s][%s] Updated %s [%s]", site.site_id, userId, className, id);
          } else {
            return Spaces.logger.debug("[%s][%s] %s#update/%s failed: %d - %s", site.site_id, userId, className, id, res.statusCode, res.status);
          }
        }));
      }));
      req.on('error', (function(e) {
        return Spaces.logger.error("[%s][%s] %s#update/%s failed: %s", site.site_id, userId, className, id, req.statusCode);
      }));
      req.write(data);
      return req.end();
    };

    return Resource;

  })();

  module.exports = exports = Resource;

}).call(this);
