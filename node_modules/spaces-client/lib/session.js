// Generated by CoffeeScript 1.6.3
(function() {
  var Session, exports, logger;

  logger = require('./logger.js');

  Session = (function() {
    function Session() {}

    Session.sessions = {};

    Session.adminId = "";

    Session.setAdminId = function(userId) {
      return this.adminId = userId;
    };

    Session.setSessionId = function(userId, id) {
      if (!this.sessions[userId]) {
        this.sessions[userId] = {};
      }
      return this.sessions[userId]["id"] = id;
    };

    Session.getSessionId = function(site, userId) {
      var session, sessionId;
      if (session = this.sessions[userId]) {
        if (sessionId = session["id"]) {
          return sessionId;
        } else {
          return logger.error("[%s][%s] Couldn't find session ID", site.site_id, userId);
        }
      } else {
        return logger.error("[%s][%s] Couldn't find user session", site.site_id, userId);
      }
    };

    Session.getRandomUserItemIdOfType = function(site, userId, type) {
      var list;
      if (this.sessions[userId]) {
        if (list = this.sessions[userId][type]) {
          return list[Math.floor(Math.random() * list.length)];
        } else {
          return logger.warn("[%s][%s] user doesn't have a valid %s", site.site_id, userId, type);
        }
      } else {
        return logger.error("[%s][%s] Couldn't find user session", site.site_id, userId);
      }
    };

    Session.getRandomSiteItemIdOfType = function(site, type) {
      var list;
      if (this.sessions[site.site_id]) {
        if (list = this.sessions[site.site_id][type]) {
          return list[Math.floor(Math.random() * list.length)];
        } else {
          return logger.warn("[%s][Unknown User] site doesn't have a valid %s", site.site_id, type);
        }
      }
    };

    Session.addItem = function(site, userId, type, item) {
      logger.debug("[%s][%s]: Added %s [%s]", site.site_id, userId, type, item);
      if (this.sessions[userId]) {
        if (!this.sessions[userId][type]) {
          this.sessions[userId][type] = [];
        }
        this.sessions[userId][type].push(item);
      } else {
        logger.error("[%s][%s] user session not found", site.site_id, userId);
      }
      if (!this.sessions[site.site_id]) {
        this.sessions[site.site_id] = {};
      }
      if (!this.sessions[site.site_id][type]) {
        this.sessions[site.site_id][type] = [];
      }
      return this.sessions[site.site_id][type].push(item);
    };

    return Session;

  })();

  module.exports = exports = Session;

}).call(this);
