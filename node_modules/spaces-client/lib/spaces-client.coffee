class SpacesClient
  @Activity: require "./activity"
  @Blog: require "./blog"
  @Category: require "./category"
  @Folder: require "./folder"
  @Forum: require "./forum"
  @Group: require "./group"
  @Ideastorm: require "./ideastorm"
  @Pod: require "./pod"
  @Resource: require "./resource"
  @Site: require "./site"
  @User: require "./user"
  @Wiki: require "./wiki"

  @logger: null; @setLogger = (logger) -> @logger = logger
  @mothershipUrl = null; @setMothershipURL = (url) -> @mothershipUrl = url
  @apiKey: null; @setApiKey = (key) -> @apiKey = key

  @socket: null; @setSocket = (socket) -> @socket = socket

  @process = (site, userId, action, sessionId, resourceId, parentId, handlers) ->
    switch action.resource
      when 'blog', 'blogpost', 'blog_post'
        klass = @Blog
      when 'activity'
        klass = @Activity
      when 'category'
        klass = @Category
      when 'folder', 'document'
        klass = @Folder
      when 'forum', 'discussion'
        klass = @Forum
      when 'group'
        klass = @Group
      when 'ideastorm', 'idea'
        klass = @Ideastorm
      when 'wiki', 'wikipage', 'wiki_page'
        klass = @Wiki
      else
        SpacesClient.logger.error "[%s][%s] Unrecognized class: %s", site, userId, action.resource
        return false

    methodName = action.method + action.resource.charAt(0).toUpperCase() + action.resource.slice(1).replace("_", "")
    args = [site, sessionId, resourceId, parentId, userId, handlers.onsuccess, handlers.onfail]
    args.push handlers.oncreate if action.method == 'create'
    args.push handlers.ondelete if action.method == 'delete'
    klass[methodName].apply(klass, args)

module.exports = SpacesClient
module.exports.setLogger = SpacesClient.setLogger
module.exports.getLogger = SpacesClient.getLogger
module.exports.setSocket = SpacesClient.setSocket
