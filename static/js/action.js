// Generated by CoffeeScript 1.6.3
(function() {
  var ACTION_METADATA, Action, SEED_METADATA, action, actions, exports, i, logger, _i, _j, _len, _ref;

  logger = require('./logger.js');

  SEED_METADATA = [['Category', 'create'], ['Category', 'create'], ['Category', 'create'], ['Category', 'create'], ['Category', 'create']];

  ACTION_METADATA = [[10, 'Activity', 'create'], [5, 'Blog', 'create', 'group'], [1, 'Blog', 'updateBlog'], [1, 'Blog', 'deleteBlog'], [10, 'Blog', 'createPost', 'blog'], [2, 'Blog', 'updatePost'], [1, 'Blog', 'deletePost'], [1, 'Category', 'create'], [5, 'Folder', 'create', 'folder'], [1, 'Folder', 'createDocument', 'folder'], [1, 'Folder', 'deleteDocument'], [5, 'Forum', 'create', 'group'], [1, 'Forum', 'updateForum'], [1, 'Forum', 'deleteForum'], [10, 'Forum', 'createDiscussion', 'discussion_archive'], [2, 'Forum', 'updateDiscussion'], [1, 'Forum', 'deleteDiscussion'], [5, 'Group', 'create', 'category'], [5, 'Group', 'create', 'group'], [10, 'Ideastorm', 'create', 'group'], [5, 'Ideastorm', 'updateIdeastorm'], [1, 'Ideastorm', 'deleteIdeastorm'], [10, 'Ideastorm', 'createIdea', 'ideastorm'], [2, 'Ideastorm', 'updateIdea'], [1, 'Ideastorm', 'deleteIdea']];

  actions = [];

  for (_i = 0, _len = ACTION_METADATA.length; _i < _len; _i++) {
    action = ACTION_METADATA[_i];
    for (i = _j = 0, _ref = action[0] - 1; _j <= _ref; i = _j += 1) {
      if (action.length < 4) {
        action[3] = null;
      }
      actions.push([action[1], action[2], action[3]]);
    }
  }

  Action = (function() {
    var Spaces;

    function Action() {}

    Spaces = require('spaces-client');

    Action.seed = function(site, userId) {
      var _k, _len1, _results;
      _results = [];
      for (_k = 0, _len1 = SEED_METADATA.length; _k < _len1; _k++) {
        action = SEED_METADATA[_k];
        _results.push(Action.launch(action, site, userId));
      }
      return _results;
    };

    Action.doSomething = function(sites, host, user) {
      var site, userId;
      action = actions[Math.floor(Math.random() * actions.length)];
      site = sites[Math.floor(Math.random() * sites.length)];
      if (!site.users) {
        site.users = [];
      }
      userId = site.users[Math.floor(Math.random() * site.users.length)];
      return Action.launch(action, site, userId);
    };

    Action.launch = function(action, site, userId) {
      var f, klass, parent, skip;
      skip = false;
      parent = null;
      if (action[2]) {
        if (!(parent = Spaces.Session.getRandomUserItemIdOfType(site, userId, action[2]))) {
          skip = true;
        }
      }
      if (!skip) {
        if (klass = Spaces[action[0]]) {
          if (f = klass[action[1]]) {
            return f.apply(klass, [site, parent, userId]);
          } else {
            return logger.error("[%s][%s] Couldn't find Spaces.%s.%s()", site.site_id, userId, action[0], action[1]);
          }
        } else {
          return logger.error("[%s][%s] Couldn't find Spaces.%s", site, userId, action[0]);
        }
      }
    };

    return Action;

  })();

  module.exports = exports = Action;

}).call(this);
